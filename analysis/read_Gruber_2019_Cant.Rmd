---
title: "Anthropogenic CO2 from 1994 to 2007"
author: "Jens Daniel MÃ¼ller"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  workflowr::wflow_html:
    number_sections: true
    toc_depth: 3
    toc_float:
      collapsed: false
editor_options:
  chunk_output_type: console
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r library, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(tidync)
library(stars)
```


```{r ggplot_theme, include = FALSE}
theme_set(theme_bw())
```

# Data source

- Anthropogenic CO2 estimates (1994-2007) by Gruber et al. (2019) downloaded in August 2020 from [NOAA/NCEI Ocean Carbon Data System (OCADS)](https://www.nodc.noaa.gov/ocads/oceans/ndp_100/ndp100.html){target="_blank"}

# Read ncdfs

```{r read_WOA18}

inv_dcant <- tidync(here::here("data/Gruber_2019",
                               "inv_dcant_emlr_cstar_gruber_94-07_vs1.nc"))

dcant <- tidync(here::here("data/Gruber_2019",
                               "dcant_emlr_cstar_gruber_94-07_vs1.nc"))


dcant <-        dcant %>%  activate(DCANT_01)
dcant_tibble <- dcant %>% hyper_tibble()


inv_dcant <- inv_dcant %>%  activate(DCANT_INV01)
inv_dcant_tibble <- inv_dcant %>% hyper_tibble()


```

# Cant plots

```{r set_criteria_horizons_sections}

depth_surface_selection <- c(0)
Atl_lon <- 335.5
Pac_lon <- 190.5

```

Below, following subsets of the climatologies are plotted for all relevant parameters:  

- Horizontal planes at `r depth_surface_selection`m
- Meridional sections at longitudes:
  - Atlantic: `r Atl_lon`
  - Pacific: `r Pac_lon`

Section locations are indicated as white lines in maps.

Please note that longitudes in the climatologies range from -179.5 - 179.5, which is different from GLODAP mapped climatologies.



## Surface Inventory map

```{r Cant_inv_map}

inv_dcant_tibble %>% 
  ggplot(aes(LONGITUDE, LATITUDE, fill = DCANT_INV01)) +
  geom_raster() +
  geom_vline(xintercept = c(Atl_lon, Pac_lon), col = "white") +
  coord_quickmap(expand = 0) +
  scale_fill_viridis_c() +
  theme(legend.position = "top")


```

## Sections

### Atlantic

```{r Cant_section_Atlantic}

dcant_tibble %>% 
  filter(LONGITUDE == Atl_lon) %>% 
  ggplot(aes(LATITUDE, DEPTH, z = DCANT_01)) +
  geom_contour_filled() +
  scale_fill_viridis_d(name = "Cant") +
  guides(fill = guide_colorsteps(barheight = unit(7, "cm"))) +
  scale_y_reverse() +
  coord_cartesian(expand = 0) +
  theme(legend.position = "top")

```

### Pacific

```{r Cant_section_Pacific}

dcant_tibble %>% 
  filter(LONGITUDE == Pac_lon) %>% 
  ggplot(aes(LATITUDE, DEPTH, z = DCANT_01)) +
  geom_contour_filled() +
  scale_fill_viridis_d(name = "Cant") +
  guides(fill = guide_colorsteps(barheight = unit(7, "cm"))) +
  scale_y_reverse() +
  coord_cartesian(expand = 0) +
  theme(legend.position = "top")

```

## Write files

```{r write_Gruber_Cant_file}

dcant_tibble %>% 
  write_csv(here::here("data/Gruber_2019/_summarized_files",
                       "dcant.csv"))

inv_dcant_tibble %>% 
  write_csv(here::here("data/Gruber_2019/_summarized_files",
                       "inv_dcant.csv"))

```



# Open tasks

- 

# Questions

- Why are there no negative Cant estimates?
