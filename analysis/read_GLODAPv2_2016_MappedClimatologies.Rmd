---
title: "GLODAPv2_2016_MappedClimatologies"
author: "Jens Daniel MÃ¼ller"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  workflowr::wflow_html:
    number_sections: true
    toc_depth: 3
    toc_float:
      collapsed: false
editor_options:
  chunk_output_type: console
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```

```{r library, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(tidync)
library(stars)
```


```{r ggplot_theme, include = FALSE}
theme_set(theme_bw())
```

# Read ncdf files

- Data source: [glodap.info](https://www.glodap.info/)

Files used:

GLODAPv2.2016b.Cant.nc

```{r read_GLODAPv2_2016_MappedClimatologies_netcdfs_tidyn, eval=FALSE}

Cant <- tidync(here::here("data/GLODAPv2_2016b_MappedClimatologies",
                          "GLODAPv2.2016b.Cant.nc"))
print(Cant)

# Cant_slice <- Cant %>% hyper_filter(depth_surface = depth_surface == 20)
# Cant_slice_tibble <- Cant_slice %>% hyper_tibble()

Cant_tibble <- Cant %>% hyper_tibble()

Cant_tibble %>% 
  ggplot(aes(lon, lat, fill=Cant))+
  geom_raster()+
  scale_fill_viridis_b()+
  facet_wrap(~depth_surface)

```

```{r read_GLODAPv2_2016_MappedClimatologies_netcdfs_stars, fig.asp=3}

file_list <- list.files(path= "data/GLODAPv2_2016b_MappedClimatologies", pattern = "*.nc")

#file <- file_list[1]

for (file in file_list) {
 
map_clim <- read_stars(here::here("data/GLODAPv2_2016b_MappedClimatologies",
                          file))

parameter <- str_split(file, pattern = "6b.", simplify = TRUE)[2]
parameter <- str_split(parameter, pattern = ".nc", simplify = TRUE)[1]

map_clim <- map_clim %>% select(all_of(parameter))

print(
ggplot()+
  geom_stars(data = map_clim)+
  scale_fill_viridis_b()+
  facet_wrap(~depth_surface, ncol = 3)+
  theme(axis.text = element_blank(),
        axis.title = element_blank())
)

}

```

# Open tasks

- none

# Questions

- none
