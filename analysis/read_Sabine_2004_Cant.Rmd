---
title: "Anthropogenic CO2 from 1994 to 2007"
author: "Jens Daniel MÃ¼ller"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  workflowr::wflow_html:
    number_sections: true
    toc_depth: 3
    toc_float:
      collapsed: false
editor_options:
  chunk_output_type: console
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r library, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
```


```{r ggplot_theme, include = FALSE}
theme_set(theme_bw())
```

# Data source

- Anthropogenic CO2 estimates (1994-2007) by Gruber et al. (2019) downloaded in August 2020 from [NOAA/NCEI Ocean Carbon Data System (OCADS)](ftp://ftp.nodc.noaa.gov/pub/data.nodc/ncei/ocads/data/0001644/){target="_blank"}

# Read ncdfs

```{r read_Sabine_2004}

AnthCO2_data <- read_csv("data/GLODAPv1_1/GLODAP_gridded.data/AnthCO2.data/AnthCO2.data.txt", 
    col_names = FALSE,
    na = "-999",
    col_types = list(.default = "d"))

Depth_centers <- read_file("data/GLODAPv1_1/GLODAP_gridded.data/Depth.centers.txt")

Depth_centers <- Depth_centers %>% 
  str_split(",") %>% 
  as_vector()

Lat_centers <- read_file("data/GLODAPv1_1/GLODAP_gridded.data/Lat.centers.txt")

Lat_centers <- Lat_centers %>% 
  str_split(",") %>% 
  as_vector()

Long_centers <- read_file("data/GLODAPv1_1/GLODAP_gridded.data/Long.centers.txt")

Long_centers <- Long_centers %>% 
  str_split(",") %>% 
  as_vector()

names(AnthCO2_data) <- Lat_centers

Long_Depth <- expand_grid(Depth = Depth_centers, Long = Long_centers) %>% 
  mutate(Long = as.numeric(Long),
         Depth = as.numeric(Depth))

Cant <- bind_cols(AnthCO2_data, Long_Depth)

Cant <- Cant %>% 
  pivot_longer(1:180, names_to = "Lat", values_to = "Cant") %>% 
  mutate(Lat = as.numeric(Lat))

Cant <- Cant %>% 
  drop_na()

rm(AnthCO2_data, Long_Depth, Depth_centers, Lat_centers, Long_centers)

```

# Cant plots

```{r set_criteria_horizons_sections}

depth_surface_selection <- c(0)
Atl_lon <- 335.5 - 360
Pac_lon <- 190.5 - 360

```

Below, following subsets of the climatologies are plotted for all relevant parameters:  

- Horizontal planes at `r depth_surface_selection`m
- Meridional sections at longitudes:
  - Atlantic: `r Atl_lon`
  - Pacific: `r Pac_lon`

Section locations are indicated as white lines in maps.

Please note that longitudes in the climatologies range from -179.5 - 179.5, which is different from GLODAP mapped climatologies.



## Surface Inventory map

```{r Cant_inv_map}

Cant %>% 
  filter(Depth == depth_surface_selection) %>% 
  ggplot(aes(Long, Lat, fill = Cant)) +
  geom_raster() +
  geom_vline(xintercept = c(Atl_lon, Pac_lon), col = "white") +
  coord_quickmap(expand = 0) +
  scale_fill_viridis_c() +
  theme(legend.position = "top")


```

## Sections

### Atlantic

```{r Cant_section_Atlantic}

Cant %>% 
  filter(Long == Atl_lon) %>% 
  ggplot(aes(Lat, Depth, z = Cant)) +
  geom_contour_filled() +
  scale_fill_viridis_d(name = "Cant") +
  guides(fill = guide_colorsteps(barheight = unit(7, "cm"))) +
  scale_y_reverse() +
  coord_cartesian(expand = 0)

```

### Pacific

```{r Cant_section_Pacific}

Cant %>% 
  filter(Long == Pac_lon) %>% 
  ggplot(aes(Lat, Depth, z = Cant)) +
  geom_contour_filled() +
  scale_fill_viridis_d(name = "Cant") +
  guides(fill = guide_colorsteps(barheight = unit(7, "cm"))) +
  scale_y_reverse() +
  coord_cartesian(expand = 0)

```

## Write files

```{r write_Sabin_Cant_file}

Cant %>% 
  write_csv(here::here("data/GLODAPv1_1/_summarized_files",
                       "Cant_Sabine_2004.csv"))


```



# Open tasks

- 

# Questions

- 
